import{k as e,u as s,r,j as a,H as t,L as i}from"./vendor-DeShHRvC.js";import{a as o,u as n,g as l}from"./index-De2e4y7I.js";import"./vendor-jspdf-CcCK2Zy6.js";import"./vendor-@react-oauth-Di4DNcpW.js";import"./http-VSpmzgsF.js";import"./vendor-matter-js-BjVipDty.js";import"./vendor-ogl-YOJCSol6.js";import"./vendor-motion-BfReZoSV.js";import"./vendor-gsap-CSqFbIEy.js";function d(){const[d]=e(),c=s(),{setUser:m}=o(),{startTransition:u}=n(),[h,p]=r.useState(""),[g,j]=r.useState(""),[x,v]=r.useState(""),[w,N]=r.useState(""),[f,b]=r.useState(!1),[y,P]=r.useState(!0),[k,S]=r.useState(!1),[R,$]=r.useState(""),[I,L]=r.useState(!1);r.useEffect(()=>{const e=d.get("token");if(!e)return $("Invalid reset link. No token provided."),void P(!1);p(e),C(e)},[d]);const C=async e=>{var s,r;try{const s=await l.get(`/password-reset/verify?token=${e}`);s.valid?(S(!0),j(s.email)):($(s.error||"Invalid or expired reset link"),S(!1))}catch(a){console.error("Token verification error:",a),$((null==(r=null==(s=a.response)?void 0:s.data)?void 0:r.error)||"Invalid or expired reset link"),S(!1)}finally{P(!1)}};return y?a.jsxs("div",{className:"login-page",children:[a.jsx(t,{children:a.jsx("title",{children:"Reset Password - JustLayMe"})}),a.jsx("div",{className:"login-container",children:a.jsxs("div",{className:"login-box",children:[a.jsx("h1",{className:"login-title",children:"Verifying..."}),a.jsx("p",{className:"login-subtitle",children:"Please wait while we verify your reset link"})]})})]}):k?a.jsxs("div",{className:"login-page",children:[a.jsxs(t,{children:[a.jsx("title",{children:"Reset Password - JustLayMe"}),a.jsx("meta",{name:"description",content:"Create a new password for your JustLayMe account"})]}),a.jsx("div",{className:"login-container",children:a.jsxs("div",{className:"login-box",children:[a.jsx("h1",{className:"login-title",children:"Reset Password"}),a.jsxs("p",{className:"login-subtitle",children:["Create a new password for ",a.jsx("strong",{children:g})]}),I?a.jsxs("div",{className:"success-message",children:[a.jsx("div",{className:"success-icon",children:"✓"}),a.jsx("h3",{children:"Password Reset Successful!"}),a.jsx("p",{children:"You're now logged in and will be redirected shortly..."})]}):a.jsxs("form",{onSubmit:async e=>{var s,r;if(e.preventDefault(),$(""),x!==w)return void $("Passwords do not match");if(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&#])[A-Za-z\d@$!%*?&#]{8,}$/.test(x)){b(!0);try{const e=await l.post("/password-reset/complete",{token:h,newPassword:x});e.success&&(localStorage.setItem("authToken",e.token),m(e.user),L(!0),setTimeout(()=>{u("/chat"),c("/chat")},2e3))}catch(a){console.error("Password reset error:",a),$((null==(r=null==(s=a.response)?void 0:s.data)?void 0:r.error)||"Failed to reset password. Please try again."),b(!1)}}else $("Password must be at least 8 characters with uppercase, lowercase, number, and special character")},className:"login-form",children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"newPassword",children:"New Password"}),a.jsx("input",{id:"newPassword",type:"password",placeholder:"••••••••",value:x,onChange:e=>v(e.target.value),required:!0,disabled:f,autoFocus:!0,pattern:"^(?=.*[a-z])(?=.*[A-Z])(?=.*\\d)(?=.*[@$!%*?&#])[A-Za-z\\d@$!%*?&#]{8,}$"}),a.jsx("p",{className:"password-requirements",children:"Must include: 8+ chars, uppercase, lowercase, number, and special character (@$!%*?&#)"})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"confirmPassword",children:"Confirm Password"}),a.jsx("input",{id:"confirmPassword",type:"password",placeholder:"••••••••",value:w,onChange:e=>N(e.target.value),required:!0,disabled:f})]}),R&&a.jsx("div",{className:"error-message",children:R}),a.jsx("button",{type:"submit",className:"btn-login",disabled:f,children:f?"Resetting Password...":"Reset Password"})]}),!I&&a.jsx("div",{className:"login-toggle",children:a.jsxs("p",{children:["Remember your password?"," ",a.jsx(i,{to:"/login",className:"toggle-button",children:"Sign In"})]})})]})})]}):a.jsxs("div",{className:"login-page",children:[a.jsx(t,{children:a.jsx("title",{children:"Reset Password - JustLayMe"})}),a.jsx("div",{className:"login-container",children:a.jsxs("div",{className:"login-box",children:[a.jsx("h1",{className:"login-title",children:"Invalid Link"}),a.jsx("div",{className:"error-message",children:R}),a.jsx("div",{style:{marginTop:"1.5rem"},children:a.jsx(i,{to:"/forgot-password",className:"btn-login",children:"Request New Reset Link"})}),a.jsx("div",{className:"login-toggle",children:a.jsx("p",{children:a.jsx(i,{to:"/login",className:"toggle-button",children:"Back to Sign In"})})})]})})]})}export{d as default};
