import{j as e,r as s,u as t,H as a,U as i}from"./vendor-DeShHRvC.js";import{g as n,f as r,a as o,d as l,B as c,e as d}from"./index-De2e4y7I.js";import{E as m}from"./vendor-jspdf-CcCK2Zy6.js";import"./vendor-jspdf-autotable-C_IpTXQp.js";import"./vendor-@react-oauth-Di4DNcpW.js";import"./http-VSpmzgsF.js";import"./vendor-matter-js-BjVipDty.js";import"./vendor-ogl-YOJCSol6.js";import"./vendor-motion-BfReZoSV.js";import"./vendor-gsap-CSqFbIEy.js";function h(e,s="paste"){try{if(!e)return console.warn("[MessageParser] No data provided"),[];let t=[];return"paste"===s?t=p(e):"file"===s?t=function(e){try{if("string"==typeof e&&(e.trimStart().startsWith("{")||e.trimStart().startsWith("[")))try{const s=JSON.parse(e);if(Array.isArray(s))return console.log("[MessageParser] Parsed as JSON array"),s;if(s.messages&&Array.isArray(s.messages))return console.log("[MessageParser] Parsed as JSON with messages property"),s.messages}catch(s){console.log("[MessageParser] JSON parse failed, trying text format")}return p(e)}catch(t){return console.error("[MessageParser] Error in parseFileFormat:",t),[]}}(e):"screenshot"===s?t=function(e){return p(e)}(e):(console.warn(`[MessageParser] Unknown format "${s}", defaulting to text parsing`),t=p(e)),function(e){if(!e||!Array.isArray(e))return[];const s=5e5;e.length>s&&(console.warn(`Message count (${e.length}) exceeds maximum. Truncating to ${s}`),e=e.slice(0,s));if(e.length<2)return e.map((e,s)=>({...e,id:s,direction:e._iMessageDirection||"sent",timeSinceLast:null}));const t=e.some(e=>e._iMessageDirection),a=[...new Set(e.map(e=>e.sender||"unknown"))].sort(),[i,n]=a.slice(0,2);let r=i;if(t){const s=e.find(e=>"sent"===e._iMessageDirection);s&&(r=s.sender)}return e.map((s,t)=>{let a,n=null;if(t>0)try{const a=s.timestamp&&"function"==typeof s.timestamp.getTime?s.timestamp.getTime():Date.now();n=a-(e[t-1].timestamp&&"function"==typeof e[t-1].timestamp.getTime?e[t-1].timestamp.getTime():Date.now())}catch(c){console.warn("Failed to calculate time difference:",c),n=null}a=s._iMessageDirection?s._iMessageDirection:s.sender===r||s.sender===i?"sent":"received";const{_iMessageDirection:o,...l}=s;return{...l,id:t,direction:a,person:s.sender||"unknown",timeSinceLast:n}})}(t)}catch(t){return console.error("[MessageParser] Parsing error:",t),[]}}function p(e){try{const t="string"==typeof e?e:String(e);if(console.log("[MessageParser] Starting parse..."),t.includes(" from ")&&t.includes(" to ")&&/\d{4}-\d{2}-\d{2}\s+\d{2}:\d{2}:\d{2}\s+(from|to)\s+/.test(t))return console.log("[MessageParser] Detected iMessage export format"),function(e){const s=[],t=e.split(/[-]{20,}/);console.log(`[MessageParser] iMessage format: ${t.length} blocks found`);for(const a of t){const e=a.trim();if(!e)continue;const t=e.match(/(\d{4}-\d{2}-\d{2}\s+\d{2}:\d{2}:\d{2})\s+(from|to)\s+([^\n(]+?)(?:\s*\([^)]*\))?\s*(?:-[^\n]*)?\n/i);if(!t){if(!e.match(/(\d{4}-\d{2}-\d{2}\s+\d{2}:\d{2}:\d{2})\s+(from|to)\s+([^\n(]+?)(?:\s*\([^)]*\))?\s*(?:-[^\n]*)?$/im))continue}const i=t||e.match(/(\d{4}-\d{2}-\d{2}\s+\d{2}:\d{2}:\d{2})\s+(from|to)\s+([^\n(]+?)(?:\s*\([^)]*\))?\s*(?:-[^\n]*)?/i);if(!i)continue;const[n,r,o,l]=i,c=new Date(r.replace(" ","T"));let d=e.substring(e.indexOf(n)+n.length).trim();const m=e.split("\n");if(m.length>0&&m[0].trim()===l.trim()){const s=e.substring(e.indexOf("\n")+1);d=s.substring(s.indexOf(n)+n.length).trim()||d}if(d=d.replace(/^\s*\n+/,"").trim(),!d||0===d.length)continue;const h="to"===o.toLowerCase()?"You":l.trim();s.push({timestamp:c,sender:h,content:d,length:d.length,_iMessageDirection:"to"===o.toLowerCase()?"sent":"received"})}return console.log(`[MessageParser] iMessage format: Parsed ${s.length} messages`),s}(t);const a=t.split(/\r?\n/).filter(e=>e.trim()),i=[];if(console.log(`[MessageParser] Using line-by-line parse: ${a.length} lines total`),a.length>0){console.log("[MessageParser] First 3 lines:");for(let e=0;e<Math.min(3,a.length);e++)console.log(`  Line ${e}: ${a[e].substring(0,100)}`)}for(let e=0;e<a.length;e++)try{const s=u(a[e],e);s&&i.push(s)}catch(s){console.warn(`[MessageParser] Error parsing line ${e}, skipping:`,s)}return console.log(`[MessageParser] Parsed ${i.length} messages from ${a.length} lines`),i}catch(t){return console.error("[MessageParser] Error in parseTextFormat:",t),[]}}function u(e,s=0){if(!e||!e.trim())return null;let t=new Date,a=e,i="unknown";const n=[/^\d{1,2}\/\d{1,2}\/\d{2,4},?\s+\d{1,2}:\d{2}(?::\d{2})?\s?(?:AM|PM)?\s*[-â€“â€”]\s*/,/^\d{4}-\d{2}-\d{2}[T\s]\d{1,2}:\d{2}(?::\d{2})?(?:\.\d+)?(?:Z|[+-]\d{2}:?\d{2})?\s*[-â€“â€”:]\s*/,/^\[\d{1,2}:\d{2}(?:\s?(?:AM|PM))?\]\s*/,/^\d{1,2}:\d{2}(?::\d{2})?\s?(?:AM|PM)?\s*[-â€“â€”]\s*/,/^\[?\d{1,2}\.\d{1,2}\.\d{2,4}\s+\d{1,2}:\d{2}(?::\d{2})?\]?\s*[-â€“â€”]?\s*/,/^\(?\d{1,2}\/\d{1,2}\/\d{2,4}\s+\d{1,2}:\d{2}(?:\s?(?:AM|PM))?\)?\s*[-â€“â€”:]\s*/];let r=null;for(const c of n)if(r=e.match(c),r)break;if(r){a=e.replace(r[0],"").trim();try{const e=new Date(r[0]);isNaN(e.getTime())||(t=e)}catch(l){}}const o=a.match(/^([^:]+):\s*(.+)$/);if(o)i=o[1].trim(),a=o[2].trim();else{const e=a.match(/^([^-â€“â€”|â†’>]+)\s*[-â€“â€”|â†’>]\s*(.+)$/);e?(i=e[1].trim(),a=e[2].trim()):(a=a.trim(),i=s%2==0?"person1":"person2")}return a&&0!==a.length?{timestamp:t,sender:i,content:a,length:a.length}:null}const g={uploadAsync:async(e,s={})=>{try{if(!(e instanceof File))throw new Error("uploadAsync requires a File object");console.log(`ðŸ“¤ Async upload: ${e.name} (${e.size} bytes)`);const t=new FormData;t.append("file",e),t.append("userName",s.userName||"You"),t.append("contactName",s.contactName||"Them"),t.append("insightsGoal",s.insightsGoal||"");const a=await n.post("/grey-mirror/upload-async",t,{headers:{"Content-Type":"multipart/form-data"},timeout:3e5,onUploadProgress:e=>{const s=Math.round(100*e.loaded/e.total);console.log(`ðŸ“Š Upload progress: ${s}%`)}});return console.log(`âœ… Job created: ${a.data.jobId}`),a.data}catch(t){throw console.error("âŒ Failed to upload async:",t),t}},getJobStatus:async e=>{try{return(await n.get(`/grey-mirror/job/${e}`)).data}catch(s){throw console.error("âŒ Failed to get job status:",s),s}},streamJobProgress:(e,s,t,a)=>{try{const i=localStorage.getItem("authToken"),n=new EventSource(`${"/api"}/grey-mirror/job/${e}/stream?token=${i}`);return n.onmessage=e=>{const a=JSON.parse(e.data);a.done?(n.close(),t&&t()):s&&s(a)},n.onerror=e=>{console.error("SSE stream error:",e),n.close(),a&&a(e)},n}catch(i){throw console.error("Failed to start SSE stream:",i),a&&a(i),i}},pollJobStatus:async(e,s,t=2e3)=>new Promise((a,i)=>{const n=async()=>{try{const t=await g.getJobStatus(e);if(s&&s({progress:t.progress,message:t.message,status:t.status}),"completed"===t.status){clearInterval(r);const e=t.results||{};e.messageCount=t.messageCount,a(e)}else"failed"===t.status&&(clearInterval(r),i(new Error(t.error||"Analysis failed")))}catch(t){clearInterval(r),i(t)}},r=setInterval(n,t);n()}),uploadAndAnalyze:async(e,s="paste",t={})=>{try{let i=e;"file"===s&&e instanceof File&&(console.log(`ðŸ“‚ Reading file: ${e.name} (${e.size} bytes)`),i=await(a=e,new Promise((e,s)=>{const t=new FileReader;t.onload=s=>e(s.target.result),t.onerror=e=>s(new Error("Failed to read file")),t.readAsText(a)})),console.log(`âœ… File read successfully, content length: ${i.length}`)),console.log("ðŸ”„ Parsing messages on frontend...");const r=h(i,s);if(!r||0===r.length)throw new Error("No messages could be parsed from the file. Please check the format.");console.log(`âœ… Parsed ${r.length} messages`),console.log(`ðŸ§  Sending ${r.length} messages to ML service...`);const o=await n.post("/grey-mirror/analyze-advanced",{messages:r,personalization:{userName:t.userName||"You",contactName:t.contactName||"Them",insightsGoal:t.insightsGoal||""}},{timeout:3e5});return console.log("âœ… Analysis complete!"),o}catch(i){throw console.error("âŒ Failed to upload and analyze:",i),i}var a},processScreenshot:async e=>{try{const s=new FormData;return s.append("image",e),s.append("timestamp",(new Date).toISOString()),await n.post("relationship/ocr",s,{headers:{"Content-Type":"multipart/form-data"}})}catch(s){throw console.error("Failed to process screenshot:",s),s}},getAnalysisProgress:async e=>{try{return await n.get(`/relationship/progress/${e}`)}catch(s){throw console.error("Failed to get analysis progress:",s),s}},getResults:async e=>{try{return await n.get(`/relationship/results/${e}`)}catch(s){throw console.error("Failed to get analysis results:",s),s}},exportResults:async(e,s="pdf")=>{try{return await n.get(`/relationship/export/${e}`,{params:{format:s},responseType:"blob"})}catch(t){throw console.error("Failed to export results:",t),t}},streamAnalysisProgress:(e,s)=>{try{const t=localStorage.getItem("authToken"),a=new EventSource(`/api/relationship/stream/${e}?token=${t}`);return a.onmessage=e=>{const t=JSON.parse(e.data);s(t)},a.onerror=e=>{console.error("Stream error:",e),a.close()},a}catch(t){throw console.error("Failed to stream analysis progress:",t),t}}};function y({title:s="Metric",icon:t=null,value:a="0%",description:i="",details:n=[],sections:r=null,comparison:o=null,summary:l="",isExpanded:c=!1,onToggle:d=()=>{},userName:m="You",contactName:h="Them"}){const p=[];return(null==r?void 0:r.you)&&Object.entries(r.you).slice(0,2).forEach(([e,s])=>{p.push(`${m}: ${f(s,m,h,e)}`)}),(null==r?void 0:r.them)&&Object.entries(r.them).slice(0,2).forEach(([e,s])=>{p.push(`${h}: ${f(s,m,h,e)}`)}),e.jsxs("div",{className:"metric-card "+(c?"expanded":""),children:[e.jsxs("div",{className:"card-header",onClick:d,children:[e.jsxs("div",{className:"header-left",children:[t&&e.jsx("span",{className:"metric-icon",children:t}),e.jsxs("div",{className:"header-text",children:[e.jsx("h3",{className:"metric-title",children:s}),i&&e.jsx("p",{className:"metric-description-preview",children:i}),e.jsx("p",{className:"metric-value",children:a}),!c&&p.length>0&&e.jsx("p",{className:"metric-preview",children:p.join(", ")})]})]}),e.jsx("div",{className:"expand-icon",children:c?"âˆ’":"+"})]}),c&&e.jsxs("div",{className:"card-content",children:[l&&e.jsx("p",{className:"metric-summary",children:l}),r&&(r.you||r.them)&&e.jsxs("div",{className:"person-sections",children:[r.you&&Object.keys(r.you).length>0&&e.jsxs("div",{className:"person-section you-section",children:[e.jsx("h4",{className:"section-title",children:m}),e.jsx("div",{className:"section-details",children:Object.entries(r.you).filter(([e,s])=>null!=s&&""!==s).map(([s,t],a)=>e.jsxs("div",{className:"detail-item",children:[e.jsxs("span",{className:"detail-label",children:[x(s),":"]}),e.jsx("span",{className:"detail-value",children:f(t,m,h,s)})]},a))})]}),r.them&&Object.keys(r.them).length>0&&e.jsxs("div",{className:"person-section them-section",children:[e.jsx("h4",{className:"section-title",children:h}),e.jsx("div",{className:"section-details",children:Object.entries(r.them).filter(([e,s])=>null!=s&&""!==s).map(([s,t],a)=>e.jsxs("div",{className:"detail-item",children:[e.jsxs("span",{className:"detail-label",children:[x(s),":"]}),e.jsx("span",{className:"detail-value",children:f(t,m,h,s)})]},a))})]})]}),o&&e.jsxs("div",{className:"comparison-section",children:[e.jsx("h4",{className:"section-title",children:"Comparison"}),e.jsx("div",{className:"section-details",children:Object.entries(o).map(([s,t],a)=>e.jsxs("div",{className:"detail-item comparison-item",children:[e.jsxs("span",{className:"detail-label",children:[x(s),":"]}),e.jsx("span",{className:`detail-value ${j(s,t)}`,children:v(s,t,m,h)})]},a))})]}),n&&n.length>0&&e.jsx("div",{className:"metric-details",children:n.map((s,t)=>e.jsxs("div",{className:"detail-item",children:[e.jsxs("span",{className:"detail-label",children:[s.label,":"]}),e.jsx("span",{className:"detail-value",children:s.value})]},t))})]})]})}function x(e){return e.replace(/([A-Z])/g," $1").replace(/_/g," ").replace(/^./,e=>e.toUpperCase()).trim()}function f(e,s="You",t="Them",a=""){if(null==e)return"â€”";if("boolean"==typeof e)return e?"Yes":"No";if("number"==typeof e){return["rate","ratio","percentage","percent","doubleTextRate","score"].some(e=>a.toLowerCase().includes(e))&&e>=0&&e<=100?`${e.toFixed(1)}%`:e>=1e3?e.toLocaleString():Number.isInteger(e)?String(e):e.toFixed(1)}if(Array.isArray(e))return 0===e.length?"None":e.map(e=>"object"==typeof e&&null!==e?JSON.stringify(e):String(e)).join(", ");if("object"==typeof e){if(void 0!==e.you&&void 0!==e.them)return`${s}: ${f(e.you,s,t,a)} / ${t}: ${f(e.them,s,t,a)}`;const i=Object.entries(e);return 0===i.length?"None":i.map(([e,s])=>`${e.replace(/_/g," ").replace(/([A-Z])/g," $1").trim()}: ${"object"==typeof s?JSON.stringify(s):String(s)}`).join(", ")}return String(e)}function v(e,s,t="You",a="Them"){return"you"===s?t:"them"===s?a:"equal"===s?"Equal":f(s,t,a)}function j(e,s){return"you"===s?"highlight-you":"them"===s?"highlight-them":"equal"===s?"highlight-equal":""}const b={deflection:{title:"Deflection Detection",description:"Shows when someone avoids difficult topics by changing the subject or making jokes. High deflection means someone regularly sidesteps serious conversations. This can indicate discomfort with vulnerability or conflict.",category:"communication"},repair_attempts:{title:"Repair Attempts",description:'Counts how often each person tries to fix misunderstandings or smooth over conflicts. Phrases like "I meant...", "let me clarify", or "I\'m sorry" indicate repair attempts. Healthy relationships show balanced repair efforts from both people.',category:"conflict"},vulnerability:{title:"Vulnerability Sharing",description:"Measures emotional openness and willingness to share feelings, fears, or personal struggles. Higher vulnerability creates deeper intimacy. Imbalanced vulnerability (one person always sharing, the other guarded) can indicate trust issues.",category:"emotional"},turn_taking:{title:"Turn Taking Balance",description:"Who talks more? This shows the conversational balance - whether both people contribute equally or one dominates. Healthy conversations have 50/50 turn-taking. Imbalance may show one person feels unheard or the other is self-focused.",category:"communication"},question_ratio:{title:"Question Engagement",description:"Tracks how many questions each person asks. Questions show curiosity and interest in the other person. If one person asks most questions, they may be carrying the emotional labor of the conversation while the other person is disengaged.",category:"engagement"},emotional_momentum:{title:"Emotional Momentum",description:"Shows how emotions build or fade during conversations. Do positive moments lead to more warmth? Do conflicts escalate or de-escalate? This reveals emotional patterns - whether you fuel each other's feelings or calm things down.",category:"emotional"},shared_vocabulary:{title:"Shared Vocabulary",description:'Identifies words and phrases you both use repeatedly. Couples develop their own "language" with inside jokes, nicknames, and common expressions. Strong shared vocabulary indicates deep connection and time spent together.',category:"communication"},conversation_dynamics:{title:"Conversation Dynamics",description:"The overall rhythm and flow of your messages. Do you have smooth back-and-forth exchanges? Long monologues? Quick bursts? This shows communication patterns - whether conversations feel natural or forced.",category:"patterns"},topic_stability:{title:"Topic Stability",description:"How well you stay on one topic versus jumping around. Low stability might mean scattered, surface-level chats. High stability shows you can have deeper, focused conversations about important subjects without constant topic switching.",category:"communication"},conversation_spiral:{title:"Conversation Spirals",description:'Detects when you argue about the same things repeatedly without resolution. Circular patterns like "we keep fighting about X" indicate unresolved core issues. Breaking these spirals requires addressing the root problem, not just the symptoms.',category:"conflict"},stress_adaptation:{title:"Stress Adaptation",description:"How does your communication change under stress or during conflicts? Do you become cold, aggressive, withdrawn? Or do you stay warm and engaged? This reveals coping mechanisms and emotional regulation skills.",category:"emotional"},entropy:{title:"Conversation Entropy",description:"Measures how predictable or chaotic your conversations are. Very high entropy means unpredictable, scattered exchanges. Very low means rigid, formulaic chats. Moderate entropy suggests natural, varied but coherent communication.",category:"patterns"},linguistic_matching:{title:"Linguistic Matching",description:"Do you mirror each other's communication style? Matching means using similar words, sentence structures, and tone. High matching shows rapport and connection. One-sided matching might mean one person is adjusting while the other isn't.",category:"communication"},power_dynamics:{title:"Power Dynamics",description:"Who controls the conversation? This tracks dominance patterns - who decides topics, who apologizes more, who asks for permission. Healthy relationships have balanced power. Imbalance can indicate control issues or inequality.",category:"patterns"},positivity_reciprocity:{title:"Positivity Reciprocity",description:"When one person is positive, does the other match that energy? Or do they stay neutral/negative? Reciprocity means both people contribute to good vibes. One-sided positivity can feel exhausting for the person trying to keep things upbeat.",category:"emotional"},responsibility_avoidance:{title:"Responsibility Avoidance",description:'Tracks patterns of deflecting blame with phrases like "you made me...", "it\'s not my fault", or "you always...". High avoidance means someone struggles to own their actions. Healthy accountability requires both people taking responsibility.',category:"conflict"},emotional_deflection:{title:"Emotional Deflection",description:"When serious emotional topics come up, does someone make jokes, change subjects, or use sarcasm? Deflection protects against vulnerability but prevents deeper connection. Repeated deflection might indicate fear of intimacy or past trauma.",category:"emotional"},love_language:{title:"Love Language Detection",description:'Discovers how you each express and receive love. The 5 love languages are: Words of Affirmation (compliments, "I love you"), Quality Time (wanting to hang out), Acts of Service (doing things for each other), Receiving Gifts (thoughtful presents), and Physical Touch (hugs, kisses). Knowing your love languages helps you feel appreciated.',category:"advanced"},gottman_ratio:{title:"Gottman 5:1 Ratio",description:"Research by Dr. John Gottman found that healthy relationships maintain at least 5 positive interactions for every 1 negative one. This metric measures your positive-to-negative ratio. Below 5:1 means negativity is overwhelming the good moments. Above 5:1 indicates a strong, resilient relationship.",category:"advanced"},response_time:{title:"Response Time Patterns",description:"How quickly do you reply to each other? Fast responses often signal high interest and priority. Slow responses might indicate busy schedules or lower emotional investment. Consistent response times show reliability. Wildly varying times could mean inconsistent interest or avoidant attachment style.",category:"advanced"},future_planning:{title:"Future Planning Analysis",description:'Do you talk about the future together? Mentions of "next week", "next year", making plans, or long-term thinking show commitment and investment. If one person plans the future while the other stays in the present, it might indicate different levels of commitment or uncertainty about the relationship.',category:"advanced"},emoji:{title:"Emoji Communication",description:"Emojis are digital body language. Hearts and positive emojis show affection. Lots of emojis indicate expressive, warm communication. Rare emoji use might mean someone is more serious or reserved. Mismatched emoji styles (one person uses tons, the other uses none) can create communication gaps.",category:"advanced"},sentiment:{title:"Sentiment Analysis",description:"Overall emotional tone of your conversations. Are messages mostly positive, negative, or neutral? This shows the general mood of the relationship. Consistently negative sentiment can predict relationship problems. Balanced or positive sentiment indicates emotional health.",category:"emotional"},patterns:{title:"Communication Patterns",description:"Who texts more often? What times of day? What length messages? This reveals communication habits and preferences. Imbalanced patterns (one person initiating all conversations) might mean unequal interest or different communication needs.",category:"patterns"},engagement:{title:"Emotional Engagement",description:"Depth of emotional investment in conversations. Are messages thoughtful and engaged, or short and surface-level? High engagement means both people care about meaningful connection. Low engagement might indicate emotional distance or disinterest.",category:"engagement"},conflict:{title:"Double/Triple Texting",description:"Sending multiple messages before getting a reply. This shows investment but can also indicate anxiety or need for validation. Who double-texts more reveals who worries more about the relationship or has higher communication needs.",category:"conflict"},apologyPatterns:{title:"Apologies & Reconciliation",description:'Who says sorry more often? Are apologies sincere ("I apologize for...") or defensive ("sorry but...")? Healthy relationships have balanced apologies. One person always apologizing might indicate power imbalance or a people-pleaser dynamic.',category:"conflict"},toxicity:{title:"Toxicity Analysis",description:"Detects harmful language patterns: insults, blame, contempt, name-calling, threats. Even occasional toxicity damages trust. Consistent toxicity is a major red flag. Healthy relationships keep toxicity near zero through respectful communication even during conflicts.",category:"conflict"},positivity:{title:"Positivity Index",description:"Overall relationship health based on kindness, appreciation, humor, support, and warmth in messages. High positivity means you lift each other up. Low positivity suggests the relationship has become cold or critical. This is one of the strongest predictors of relationship satisfaction.",category:"emotional"}};function N({results:t={},expandedMetrics:a=[],personalization:i={userName:"You",contactName:"Them"}}){const n=s.useMemo(()=>{const e=[];return t.metrics&&"object"==typeof t.metrics?Object.keys(t.metrics).forEach(s=>{const a=t.metrics[s];void 0!==(null==a?void 0:a.success)?a.success&&a.data&&e.push(s):a&&"object"==typeof a&&e.push(s)}):Object.keys(t).forEach(s=>{b[s]&&t[s]&&e.push(s)}),e},[t]),[r,o]=s.useState(n),l=s.useMemo(()=>{const e=[];return console.log("[MetricsExplorer] Results received:",t),console.log("[MetricsExplorer] Results.metrics:",null==t?void 0:t.metrics),t.metrics&&"object"==typeof t.metrics?(console.log("[MetricsExplorer] Using new ML service format"),Object.entries(t.metrics).forEach(([s,t])=>{console.log(`[MetricsExplorer] Processing metric: ${s}`,t);let a=null;if(void 0!==(null==t?void 0:t.success)?t.success&&t.data&&(a=t.data):t&&"object"==typeof t&&(a=t),a){const t=b[s]||{title:s.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase()),description:`Analysis of ${s.replace(/_/g," ")}`,category:"other"};e.push({id:s,title:t.title,description:t.description,category:t.category,data:a})}})):(console.log("[MetricsExplorer] Using legacy format"),Object.keys(t).forEach(s=>{b[s]&&t[s]&&e.push({id:s,title:b[s].title,description:b[s].description,category:b[s].category,data:t[s]})})),console.log("[MetricsExplorer] Total metrics to display:",e.length),e.sort((e,s)=>"advanced"===e.category&&"advanced"!==s.category?-1:"advanced"!==e.category&&"advanced"===s.category?1:e.title.localeCompare(s.title))},[t]);return 0===l.length?e.jsxs("div",{className:"metrics-explorer",children:[e.jsx("h2",{children:"Relationship Metrics"}),e.jsx("p",{className:"explorer-description",children:"No metrics available to display"})]}):e.jsxs("div",{className:"metrics-explorer",children:[e.jsx("h2",{children:"Relationship Metrics"}),e.jsxs("p",{className:"explorer-description",children:["Click on any metric to view detailed per-person breakdowns and comparisons",l.some(e=>"advanced"===e.category)&&e.jsxs("span",{className:"advanced-badge",children:[" â€¢ Including ",l.filter(e=>"advanced"===e.category).length," Advanced ML Metrics"]})]}),e.jsx("div",{className:"metrics-grid",children:l.map(s=>{const t=s.data||{};console.log(`[MetricsExplorer] Metric "${s.title}" data:`,t);let a=null;const n=t.user||t.you||t[i.userName],l=t.contact||t.them||t[i.contactName];(n||l)&&(a={you:t.user||t.you||t[i.userName]||{},them:t.contact||t.them||t[i.contactName]||{}},console.log(`[MetricsExplorer] Extracted sections for "${s.title}":`,a));const c=[];return Object.entries(t).forEach(([e,s])=>{if(["value","score","summary","interpretation","sections","comparison"].includes(e))return;const t=["user","you","contact","them",i.userName,i.contactName].includes(e);if(null!=s&&""!==s){if("object"==typeof s&&null!==s){if(Array.isArray(s)){if(0===s.length)return;const a=s.map(e=>"object"==typeof e&&null!==e?Object.entries(e).map(([e,s])=>`${e}: ${s}`).join(", "):String(e)).join(" | ");return void(t||c.push({label:e.replace(/_/g," ").replace(/([A-Z])/g," $1").trim(),value:a}))}if(t)return;{const t=Object.entries(s);if(0===t.length)return;return void t.forEach(([s,t])=>{if(null!=t&&""!==t){let a=t;"object"==typeof t&&null!==t&&(a=Array.isArray(t)?t.join(", "):Object.entries(t).map(([e,s])=>`${e}: ${s}`).join(", ")),c.push({label:`${e} - ${s}`.replace(/_/g," ").replace(/([A-Z])/g," $1").trim(),value:String(a)})}})}}t||c.push({label:e.replace(/_/g," ").replace(/([A-Z])/g," $1").trim(),value:String(s)})}}),console.log(`[MetricsExplorer] Final details for "${s.title}":`,c),e.jsx(y,{title:s.title,icon:null,value:t.value||t.score||"â€”",description:s.description,details:c,sections:a||t.sections||null,comparison:t.comparison||null,summary:t.summary||t.interpretation||"",isExpanded:r.includes(s.id),onToggle:()=>{return e=s.id,void o(s=>{const t=Array.isArray(s)?s:[];return t.includes(e)?t.filter(s=>s!==e):[...t,e]});var e},userName:i.userName||"You",contactName:i.contactName||"Them"},s.id)})})]})}const w=[{value:"pdf",label:"ðŸ“„ PDF Report",description:"Full report with charts"},{value:"csv",label:"ðŸ“Š CSV Data",description:"Raw metrics data"},{value:"json",label:"{ } JSON",description:"Complete analysis JSON"}];function S({results:t={}}){const[a,i]=s.useState(!1),[n,o]=s.useState(!1),l=r(),c=async e=>{o(!0);try{switch(e){case"pdf":(()=>{const e=new m,s=(new Date).toLocaleDateString();e.setFontSize(20),e.text("The Grey Mirror Analysis Report",20,20),e.setFontSize(10),e.text(`Generated: ${s}`,20,30),e.text(`Analysis ID: ${t.analysisId||"N/A"}`,20,35),e.setFontSize(14),e.text("Summary",20,50),e.setFontSize(10);const a=[["Overall Health Score",t.healthScore||"N/A"],["Messages Analyzed",t.messageCount||"0"],["Analysis Date",t.date||s],["Upload Method",t.uploadMethod||"N/A"]];if(e.autoTable({startY:55,head:[["Metric","Value"]],body:a,theme:"grid",headStyles:{fillColor:[66,139,202]}}),t.metrics&&Object.keys(t.metrics).length>0){e.setFontSize(14),e.text("Detailed Metrics",20,e.lastAutoTable.finalY+15);const s=Object.entries(t.metrics).map(([e,s])=>[e.replace(/([A-Z])/g," $1").trim(),"object"==typeof s?JSON.stringify(s):String(s)]);e.autoTable({startY:e.lastAutoTable.finalY+20,head:[["Metric","Value"]],body:s,theme:"striped",headStyles:{fillColor:[66,139,202]}})}t.insights&&Array.isArray(t.insights)&&(e.setFontSize(14),e.text("Key Insights",20,e.lastAutoTable.finalY+15),e.setFontSize(10),t.insights.forEach((s,t)=>{const a=e.lastAutoTable.finalY+25+10*t;e.text(`${t+1}. ${s}`,25,a)}));const i=e.internal.getNumberOfPages();for(let t=1;t<=i;t++)e.setPage(t),e.setFontSize(8),e.text(`Page ${t} of ${i} - JustLayMe The Grey Mirror Report`,e.internal.pageSize.width/2,e.internal.pageSize.height-10,{align:"center"});e.save(`black-mirror-analysis-${s.replace(/\//g,"-")}.pdf`)})();break;case"csv":(()=>{const e=(new Date).toISOString();let s="Metric,Value\n";s+=`"Overall Health Score","${t.healthScore||"N/A"}"\n`,s+=`"Messages Analyzed","${t.messageCount||"0"}"\n`,s+=`"Analysis Date","${t.date||e}"\n`,s+=`"Upload Method","${t.uploadMethod||"N/A"}"\n`,s+="\n",t.metrics&&Object.keys(t.metrics).length>0&&(s+='"Detailed Metrics"\n',Object.entries(t.metrics).forEach(([e,t])=>{const a=e.replace(/([A-Z])/g," $1").trim(),i="object"==typeof t?JSON.stringify(t).replace(/"/g,'""'):String(t).replace(/"/g,'""');s+=`"${a}","${i}"\n`}));const a=new Blob([s],{type:"text/csv;charset=utf-8;"}),i=URL.createObjectURL(a),n=document.createElement("a");n.href=i,n.download=`black-mirror-analysis-${(new Date).toISOString().split("T")[0]}.csv`,n.click(),URL.revokeObjectURL(i)})();break;case"json":(()=>{const e={exportedAt:(new Date).toISOString(),analysisId:t.analysisId||`analysis_${Date.now()}`,...t},s=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),a=URL.createObjectURL(s),i=document.createElement("a");i.href=a,i.download=`black-mirror-analysis-${(new Date).toISOString().split("T")[0]}.json`,i.click(),URL.revokeObjectURL(a)})();break;default:throw new Error(`Unknown format: ${e}`)}l.success(`Successfully exported as ${e.toUpperCase()}!`),i(!1)}catch(s){console.error("Export failed:",s),l.error(`Export failed: ${s.message}`)}finally{o(!1)}};return e.jsxs("div",{className:"export-button-wrapper",children:[e.jsx("button",{className:"btn btn-primary",onClick:()=>i(!a),disabled:n,children:n?"â³ Exporting...":"â¬‡ï¸ Export Results"}),a&&e.jsx("div",{className:"export-menu",children:w.map(s=>e.jsxs("button",{className:"export-option",onClick:()=>c(s.value),disabled:n,children:[e.jsx("div",{className:"option-label",children:s.label}),e.jsx("div",{className:"option-description",children:s.description})]},s.value))})]})}const M=[{title:"Better Results",text:"Include at least 100 messages for more accurate relationship insights."},{title:"Message Format",text:'The "Name: message" format works best. Include timestamps when possible.'},{title:"Time Range",text:"Longer conversation history reveals more meaningful patterns over time."},{title:"Both Perspectives",text:"Make sure to include messages from both people in the conversation."},{title:"Date Context",text:"Including timestamps helps identify communication trends over days and weeks."},{title:"Natural Flow",text:"Include full conversation threads rather than cherry-picked messages."},{title:"Processing Time",text:"Deep AI analysis may take 1-3 minutes depending on conversation length."},{title:"Multiple Exports",text:"You can combine message exports from different periods for comprehensive analysis."},{title:"Privacy First",text:"Your messages are analyzed locally and never stored on our servers."},{title:"Iterative Insights",text:"Run multiple analyses over time to track relationship dynamics."}];function A({isOpen:t=!1,results:a={},onClose:i=()=>{},onAnalyze:n=()=>{},personalization:r={userName:"You",contactName:"Them",insightsGoal:""}}){const[o,l]=s.useState(!1),[c,d]=s.useState(""),[m,h]=s.useState(""),[p,u]=s.useState(0);s.useEffect(()=>{if(!o)return;const e=setInterval(()=>{u(e=>(e+1)%M.length)},4e3);return()=>clearInterval(e)},[o]);const g=async()=>{l(!0),h(""),d("");try{const e={healthScore:a.healthScore,messageCount:a.messageCount,date:a.date,sentiment:a.sentiment,patterns:a.patterns,engagement:a.engagement,conflict:a.conflict,toxicity:a.toxicity,positivity:a.positivity,summary:a.summary,insights:a.insights,recommendations:a.recommendations,timestamp:a.timestamp,messageExcerpts:a.messageExcerpts||[],personalization:{userName:r.userName||"You",contactName:r.contactName||"Them",insightsGoal:r.insightsGoal||""}},s=await fetch("/api/grey-mirror/analyze-with-llm",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")||""}`},credentials:"include",body:JSON.stringify(e)});if(!s.ok)throw new Error(`HTTP ${s.status}`);const t=s.body.getReader(),i=new TextDecoder;for(;;){const{done:e,value:s}=await t.read();if(e)break;const a=i.decode(s);d(e=>e+a)}}catch(e){h(`Analysis failed: ${e.message}`),console.error("LLM analysis error:",e)}finally{l(!1)}};return t?e.jsx("div",{className:"llm-modal-overlay",onClick:i,children:e.jsxs("div",{className:"llm-modal",onClick:e=>e.stopPropagation(),children:[e.jsxs("div",{className:"llm-modal-header",children:[e.jsx("h2",{children:"AI Deep Analysis"}),e.jsx("p",{children:"Let our AI dive deeper into your relationship dynamics"}),e.jsx("button",{className:"btn-close",onClick:i,children:"Ã—"})]}),e.jsx("div",{className:"llm-modal-content",children:o?e.jsxs("div",{className:"analyzing-state",children:[e.jsx("div",{className:"loading-spinner-container",children:e.jsx("div",{className:"loading-spinner"})}),e.jsx("h3",{className:"analyzing-title",children:"Analyzing your conversation..."}),e.jsx("p",{className:"analyzing-subtitle",children:"This may take 1-3 minutes for comprehensive analysis"}),e.jsx("div",{className:"tip-container",children:e.jsxs("div",{className:"tip-card",children:[e.jsx("span",{className:"tip-label",children:"Tip"}),e.jsx("h4",{className:"tip-title",children:M[p].title}),e.jsx("p",{className:"tip-text",children:M[p].text})]},p)})]}):c?e.jsxs("div",{className:"insights-display",children:[e.jsx("div",{className:"insights-text",children:c}),e.jsxs("div",{className:"insights-actions",children:[e.jsx("button",{className:"btn btn-primary",onClick:g,disabled:o,children:"Regenerate Analysis"}),e.jsx("button",{className:"btn btn-secondary",onClick:i,children:"Close"})]})]}):m?e.jsxs("div",{className:"error-display",children:[e.jsx("p",{className:"error-text",children:m}),e.jsx("button",{className:"btn btn-primary",onClick:g,disabled:o,children:"Try Again"})]}):e.jsxs("div",{className:"initial-state",children:[e.jsxs("div",{className:"info-box",children:[e.jsx("p",{children:e.jsx("strong",{children:"What you'll get:"})}),e.jsxs("ul",{children:[e.jsx("li",{children:"Personalized relationship insights"}),e.jsx("li",{children:"Deeper pattern analysis"}),e.jsx("li",{children:"Actionable recommendations"}),e.jsx("li",{children:"Communication improvement tips"})]})]}),e.jsx("button",{className:"btn btn-primary btn-large",onClick:g,disabled:o,children:"Get AI Analysis"}),e.jsx("p",{className:"info-text",children:"Our AI will synthesize all metrics and provide detailed insights tailored to your relationship."})]})})]})}):null}function k({results:t={},expandedMetrics:a=[],onRestart:i=()=>{},personalization:n=null}){const[r,o]=s.useState(!1),l=n||t.personalization||{userName:"You",contactName:"Them",insightsGoal:""};return e.jsxs("div",{className:"results-section",children:[e.jsxs("div",{className:"results-header",children:[e.jsx("h2",{children:"Analysis Complete"}),e.jsx("p",{children:"Here are your relationship insights and metrics"})]}),e.jsxs("div",{className:"summary-stats",children:[e.jsx("div",{className:"stat-card",children:e.jsxs("div",{className:"stat-content",children:[e.jsx("div",{className:"stat-label",children:"Overall Health"}),e.jsx("div",{className:"stat-value",children:t.healthScore||"â€”"})]})}),e.jsx("div",{className:"stat-card",children:e.jsxs("div",{className:"stat-content",children:[e.jsx("div",{className:"stat-label",children:"Messages Analyzed"}),e.jsx("div",{className:"stat-value",children:t.messageCount||"â€”"})]})}),e.jsx("div",{className:"stat-card",children:e.jsxs("div",{className:"stat-content",children:[e.jsx("div",{className:"stat-label",children:"Analysis Date"}),e.jsx("div",{className:"stat-value",children:t.date||"â€”"})]})})]}),e.jsx(N,{results:t,expandedMetrics:a,personalization:l}),e.jsxs("div",{className:"results-actions",children:[e.jsx("button",{className:"btn btn-primary",onClick:()=>o(!0),children:"Get AI Analysis"}),e.jsx(S,{results:t}),e.jsx("button",{className:"btn btn-secondary",onClick:i,children:"Analyze Another"})]}),e.jsx(A,{isOpen:r,results:t,onClose:()=>o(!1),personalization:l})]})}const $=[{id:"parsing",label:"Parsing Conversation Data",duration:2e3,description:"Reading and structuring your messages"},{id:"extraction",label:"Extracting Messages",duration:3e3,description:"Identifying conversation patterns"},{id:"analysis",label:"Running ML Analysis",duration:24e4,description:"Processing through 22 advanced analyzers"},{id:"insights",label:"Generating Insights",duration:15e3,description:"Compiling your relationship report"}];function T({isOpen:t,totalMessages:a=0}){const[i,n]=s.useState(0),[r,o]=s.useState(0),[l,c]=s.useState(0);if(s.useEffect(()=>{if(!t)return n(0),o(0),void c(0);const e=$[i],s=Date.now(),a=setInterval(()=>{const t=Date.now()-s,a=Math.min(t/e.duration*100,100);o(a),a>=100&&i<$.length-1&&(n(e=>e+1),o(0))},100);return()=>clearInterval(a)},[t,i]),s.useEffect(()=>{if(!t)return;const e=setInterval(()=>{c(e=>e+1)},1e3);return()=>clearInterval(e)},[t]),!t)return null;const d=(i+r/100)/$.length*100;return e.jsx("div",{className:"analysis-progress-modal-overlay",children:e.jsxs("div",{className:"analysis-progress-modal",children:[e.jsxs("div",{className:"neural-eye",children:[e.jsx("div",{className:"eye-ring"}),e.jsx("div",{className:"eye-pupil",children:e.jsx("div",{className:"scanning-beam"})})]}),e.jsx("h2",{className:"modal-title",children:"NEURAL ANALYSIS IN PROGRESS"}),e.jsxs("p",{className:"modal-subtitle",children:["Processing ",a>0?a.toLocaleString():"..."," messages through 22 advanced analyzers"]}),e.jsxs("div",{className:"overall-progress",children:[e.jsx("div",{className:"progress-bar",children:e.jsx("div",{className:"progress-fill",style:{width:`${d}%`},children:e.jsx("div",{className:"progress-shine"})})}),e.jsxs("div",{className:"progress-label",children:[Math.round(d),"% Complete â€¢ ",(m=l,`${Math.floor(m/60)}:${(m%60).toString().padStart(2,"0")}`)," elapsed"]})]}),e.jsx("div",{className:"pipeline-stages",children:$.map((s,t)=>{const a=t===i,n=t<i,o=t>i;return e.jsxs("div",{className:`stage ${a?"active":""} ${n?"completed":""} ${o?"pending":""}`,children:[e.jsxs("div",{className:"stage-icon",children:[n&&e.jsx("span",{className:"icon-check",children:"âœ“"}),a&&e.jsx("span",{className:"icon-spinner",children:"â—"}),o&&e.jsx("span",{className:"icon-pending",children:"â—‹"})]}),e.jsxs("div",{className:"stage-content",children:[e.jsx("div",{className:"stage-label",children:s.label}),e.jsx("div",{className:"stage-description",children:s.description}),a&&e.jsx("div",{className:"stage-progress-bar",children:e.jsx("div",{className:"stage-progress-fill",style:{width:`${r}%`}})})]})]},s.id)})}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("div",{className:"neural-pulse"}),e.jsx("p",{className:"footer-text",children:"This may take several minutes for large conversations â€¢ Do not close this window"})]})]})});var m}function E(){const n=t(),{user:r}=o(),m=l("premium-paywall"),[h,p]=s.useState(!1),[u,y]=s.useState([]),x=s.useRef(null),[f,v]=s.useState({x:.5,y:.5}),[j,b]=s.useState(!1),[N,w]=s.useState(""),[S,M]=s.useState(""),[A,$]=s.useState(""),[E,O]=s.useState(0),I=()=>({userName:N.trim()||"You",contactName:S.trim()||"Them",insightsGoal:A.trim()||""}),[C,P]=s.useState(!0===(null==r?void 0:r.isPremium)),[D,R]=s.useState(Date.now()),{isAnalyzing:F,analysisId:z,mlReport:L,error:U,setAnalyzing:Y,setAnalysisId:_,setMLReport:G,setError:H,clearError:B}=s.useContext(c);s.useEffect(()=>{if(!(null==r?void 0:r.id))return;const e=async()=>{try{const e=await fetch("/api/verify-premium",{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}});if(e.ok){const s=await e.json();P(s.isPremium)}}catch(e){console.error("Failed to verify premium status:",e)}};e();const s=setInterval(e,3e5);return()=>clearInterval(s)},[null==r?void 0:r.id]),s.useEffect(()=>{const e=e=>{v({x:e.clientX/window.innerWidth,y:e.clientY/window.innerHeight})};return window.addEventListener("mousemove",e),()=>window.removeEventListener("mousemove",e)},[]),s.useEffect(()=>{const e=x.current;if(!e)return;const s=e.getContext("2d");let t;e.width=e.offsetWidth,e.height=e.offsetHeight;const a=()=>{s.fillStyle="#000000",s.fillRect(0,0,e.width,e.height);for(let t=0;t<e.height;t+=4)s.fillStyle="rgba(20, 40, 60, 0.08)",s.fillRect(0,t,e.width,2);t=requestAnimationFrame(a)};return a(),()=>cancelAnimationFrame(t)},[]),s.useEffect(()=>{L&&!F&&b(!0)},[L,F]);const J=()=>{n("/chat")},W=90*(f.x-.5),q=90*(f.y-.5),V=Math.sqrt(Math.pow(f.x-.5,2)+Math.pow(f.y-.5,2)),Z=35*(f.x-.5)*2,K=35*(f.y-.5)*2,Q=20+12*(1-Math.min(V,1)),X=.15+.3*Math.max(Math.abs(f.x-.5),Math.abs(f.y-.5));return e.jsxs(e.Fragment,{children:[e.jsxs(a,{children:[e.jsx("title",{children:"The Grey Mirror - Neural Surveillance | JustLayMe"}),e.jsx("meta",{name:"description",content:"Upload your consciousness for deep neural analysis. The eye sees all."}),e.jsx("link",{rel:"canonical",href:"https://justlay.me/grey-mirror"}),e.jsx("meta",{property:"og:title",content:"The Grey Mirror - Neural Surveillance | JustLayMe"}),e.jsx("meta",{property:"og:description",content:"Upload your consciousness for deep neural analysis. The eye sees all."}),e.jsx("meta",{property:"og:url",content:"https://justlay.me/grey-mirror"}),e.jsx("meta",{property:"og:type",content:"website"}),e.jsx("meta",{property:"og:image",content:"https://justlay.me/og-image.jpg"}),e.jsx("meta",{property:"og:image:width",content:"1200"}),e.jsx("meta",{property:"og:image:height",content:"630"}),e.jsx("meta",{name:"twitter:card",content:"summary_large_image"}),e.jsx("meta",{name:"twitter:title",content:"The Grey Mirror - Neural Surveillance | JustLayMe"}),e.jsx("meta",{name:"twitter:description",content:"Upload your consciousness for deep neural analysis. The eye sees all."}),e.jsx("meta",{name:"twitter:image",content:"https://justlay.me/twitter-image.jpg"})]}),e.jsxs("div",{className:"blackmirror-page-eye",children:[e.jsx("canvas",{ref:x,className:"scanline-canvas"}),j&&L?e.jsxs("div",{className:"results-container",children:[e.jsx(k,{results:L,expandedMetrics:{},onRestart:()=>{y([]),b(!1),G(null)},personalization:I()}),e.jsx("button",{className:"btn-back-eye",onClick:J,children:"â† Back to Chat"})]}):e.jsxs("div",{className:"eye-interface",children:[e.jsxs("div",{className:"eye-title",children:[e.jsx("h1",{className:"title-text",children:e.jsx(d,{speed:5,children:"THE GREY MIRROR"})}),e.jsx("div",{className:"title-divider"})]}),e.jsxs("div",{className:"personalization-fields",children:[e.jsxs("div",{className:"name-fields",children:[e.jsxs("div",{className:"field-group",children:[e.jsx("label",{htmlFor:"userName",children:e.jsx(d,{speed:5,children:"Your Name"})}),e.jsx("input",{type:"text",id:"userName",placeholder:"Enter your name...",value:N,onChange:e=>w(e.target.value),disabled:F,className:"personalization-input"})]}),e.jsxs("div",{className:"field-group",children:[e.jsx("label",{htmlFor:"contactName",children:e.jsx(d,{speed:5,children:"Their Name"})}),e.jsx("input",{type:"text",id:"contactName",placeholder:"Who are you messaging...",value:S,onChange:e=>M(e.target.value),disabled:F,className:"personalization-input"})]})]}),e.jsxs("div",{className:"field-group insights-field",children:[e.jsx("label",{htmlFor:"insightsGoal",children:e.jsx(d,{speed:5,children:"What insights are you looking for?"})}),e.jsx("textarea",{id:"insightsGoal",placeholder:"e.g., 'Are they actually interested in me?', 'Is this relationship healthy?', 'Why do we keep arguing?'",value:A,onChange:e=>$(e.target.value),disabled:F,className:"insights-textarea",rows:2})]})]}),e.jsxs("div",{className:"upload-instructions",children:[e.jsx("h3",{children:"How to Export Your Conversations"}),e.jsxs("div",{className:"export-guides",children:[e.jsxs("div",{className:"guide-section",children:[e.jsx("h4",{children:"iPhone/iMessage"}),e.jsxs("ol",{children:[e.jsx("li",{children:"Open the conversation in Messages"}),e.jsx("li",{children:"Tap the contact's name at the top"}),e.jsx("li",{children:'Scroll down and tap "Export Chat"'}),e.jsx("li",{children:'Select "Without Media" for faster processing'}),e.jsx("li",{children:"Save as .txt file and upload here"})]}),e.jsxs("p",{className:"tip",children:[e.jsx("strong",{children:"Tip:"}),' iMessage exports are in the format "Sender: Message" which works perfectly!']})]}),e.jsxs("div",{className:"guide-section",children:[e.jsx("h4",{children:"WhatsApp"}),e.jsxs("ol",{children:[e.jsx("li",{children:"Open the chat you want to analyze"}),e.jsx("li",{children:"Tap the three dots menu (Android) or contact name (iPhone)"}),e.jsx("li",{children:'Select "More" then "Export Chat"'}),e.jsx("li",{children:'Choose "Without Media"'}),e.jsx("li",{children:"Save and upload the .txt file"})]}),e.jsxs("p",{className:"tip",children:[e.jsx("strong",{children:"Format:"}),' "[Date, Time] Name: Message" works great!']})]}),e.jsxs("div",{className:"guide-section",children:[e.jsx("h4",{children:"Instagram/Facebook Messenger"}),e.jsxs("ol",{children:[e.jsx("li",{children:"Go to Settings then Privacy then Download Your Information"}),e.jsx("li",{children:'Select "Messages" only'}),e.jsx("li",{children:"Choose JSON format"}),e.jsx("li",{children:"Wait for download link (can take up to 24 hours)"}),e.jsx("li",{children:"Upload the messages.json file"})]}),e.jsxs("p",{className:"tip",children:[e.jsx("strong",{children:"Note:"})," JSON files are automatically parsed correctly!"]})]}),e.jsxs("div",{className:"guide-section",children:[e.jsx("h4",{children:"Android SMS"}),e.jsxs("ol",{children:[e.jsx("li",{children:'Install "SMS Backup & Restore" app'}),e.jsx("li",{children:'Open app and tap "Backup"'}),e.jsx("li",{children:"Select the conversation"}),e.jsx("li",{children:"Choose .txt or .xml format"}),e.jsx("li",{children:"Share/upload the file here"})]})]})]}),e.jsxs("div",{className:"format-requirements",children:[e.jsx("h4",{children:"Supported Formats"}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Text Files (.txt):"}),' Any format with "Name: Message" or "From/To" structure']}),e.jsxs("li",{children:[e.jsx("strong",{children:"JSON Files (.json):"})," Messenger exports, custom formats with sender/message fields"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"CSV Files (.csv):"})," Spreadsheet exports with timestamp, sender, message columns"]})]})]}),e.jsxs("div",{className:"best-practices",children:[e.jsx("h4",{children:"Tips for Best Results"}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Include at least 100 messages"})," for meaningful analysis"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Export full conversations"})," - more data = better insights"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Enter both names accurately"})," above - this ensures metrics are attributed correctly"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Keep timestamps if possible"})," - they enable time-based analysis"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"One conversation at a time"})," - don't mix multiple people in one upload"]})]})]})]}),U&&e.jsxs("div",{className:"error-container",style:{marginBottom:"2rem",padding:"1rem",backgroundColor:"rgba(220, 38, 38, 0.1)",border:"1px solid rgba(220, 38, 38, 0.5)",borderRadius:"8px",color:"#fca5a5",fontSize:"0.95rem",display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem"},children:[e.jsxs("div",{children:[e.jsx("strong",{children:"âš ï¸ Analysis Error:"})," ",U]}),e.jsx("button",{onClick:B,style:{padding:"0.5rem 1rem",backgroundColor:"rgba(220, 38, 38, 0.2)",color:"#fca5a5",border:"1px solid rgba(220, 38, 38, 0.5)",borderRadius:"4px",cursor:"pointer",fontSize:"0.85rem",whiteSpace:"nowrap"},children:"âœ• Dismiss"})]}),e.jsx("div",{onDragOver:e=>{e.preventDefault(),p(!0)},onDragLeave:()=>{p(!1)},onDrop:e=>{if(e.preventDefault(),p(!1),!C)return void m.openModal({feature:"The Grey Mirror Analysis",description:"Upload your consciousness and reveal the truth about your relationships"});const s=Array.from(e.dataTransfer.files);for(const t of s)if(t.size>52428800)return void H(`File "${t.name}" exceeds 50MB limit (${(t.size/1024/1024).toFixed(1)}MB)`);y(s),b(!1),G(null)},className:"mirror-container "+(h?"dragging":""),children:e.jsxs("div",{className:"outer-ring",style:{borderColor:`rgba(255, 255, 255, ${X})`,boxShadow:`\n                    inset 0 0 60px rgba(0, 0, 0, 0.9),\n                    inset -6px -6px 15px rgba(200, 200, 200, 0.1),\n                    inset 6px 6px 15px rgba(0, 0, 0, 0.5),\n                    0 0 20px rgba(255, 255, 255, ${.5*X}),\n                    0 0 20px rgba(255, 255, 255, ${.5*X})\n                  `},children:[e.jsx("div",{className:"iris-ring-1"}),e.jsx("div",{className:"iris-ring-2"}),e.jsx("div",{className:"iris-gradient"}),e.jsxs("div",{className:"pupil",style:{transform:`translate(calc(-50% + ${W}px), calc(-50% + ${q}px))`,left:"50%",top:"50%"},children:[e.jsxs("svg",{className:"iris-pattern",viewBox:"0 0 128 128",preserveAspectRatio:"xMidYMid slice",children:[e.jsx("defs",{children:e.jsx("filter",{id:"irisGlow",children:e.jsx("feGaussianBlur",{stdDeviation:"1"})})}),Array.from({length:24}).map((s,t)=>{const a=t/24*Math.PI*2,i=64+20*Math.cos(a),n=64+20*Math.sin(a),r=64+55*Math.cos(a),o=64+55*Math.sin(a);return e.jsx("line",{x1:i,y1:n,x2:r,y2:o,stroke:"rgba(100, 200, 255, 0.4)",strokeWidth:"0.8",filter:"url(#irisGlow)"},t)}),Array.from({length:5}).map((s,t)=>e.jsx("circle",{cx:"64",cy:"64",r:25+7*t,fill:"none",stroke:"rgba(100, 200, 255, 0.25)",strokeWidth:"0.6"},`ring-${t}`)),Array.from({length:12}).map((s,t)=>{const a=t/12*Math.PI*2+.5*Math.random(),i=30+15*Math.random(),n=64+Math.cos(a)*i,r=64+Math.sin(a)*i;return e.jsx("circle",{cx:n,cy:r,r:3*Math.random()+1,fill:"rgba(100, 200, 255, 0.3)",opacity:"0.6"},`texture-${t}`)})]}),e.jsx("div",{className:"iris-highlight"}),e.jsx("div",{className:"pupil-center",style:{width:`${Q}px`,height:`${Q}px`,transform:`translate(calc(-50% + ${Z}px), calc(-50% + ${K}px))`,left:"50%",top:"50%"}})]}),e.jsxs("div",{className:"upload-label",children:[e.jsx(i,{className:"upload-icon "+(h?"active":"")}),e.jsx("p",{className:"upload-text "+(h?"active":""),children:e.jsx(d,{speed:5,children:F?"ANALYZING":h?"ABSORBING":C?"UPLOAD":"PREMIUM"})}),!C&&e.jsx("p",{className:"premium-hint",children:e.jsx(d,{speed:5,children:"Click to upgrade"})})]}),e.jsx("input",{type:"file",multiple:!0,accept:".txt,.csv,.json,.pdf,.html,.xml,.chat",onChange:e=>{if(!C)return e.preventDefault(),e.target.value="",void m.openModal({feature:"The Grey Mirror Analysis",description:"Upload your consciousness and reveal the truth about your relationships"});const s=Array.from(e.target.files||[]);for(const t of s)if(t.size>52428800)return H(`File "${t.name}" exceeds 50MB limit (${(t.size/1024/1024).toFixed(1)}MB)`),void(e.target.value="");y(s),b(!1),G(null),e.target.value=""},className:"file-input-hidden",id:"file-input",disabled:F}),e.jsx("label",{htmlFor:"file-input",className:"file-input-label"})]})}),u.length>0&&e.jsxs("div",{className:"file-list",children:[e.jsx("p",{className:"file-list-title",children:e.jsxs(d,{speed:5,children:["CONVERSATIONS LOADED â€¢ ",u.length," FILE",1!==u.length?"S":""]})}),e.jsx("div",{className:"file-items",children:u.map((s,t)=>e.jsx("div",{className:"file-item",children:e.jsxs(d,{speed:5,children:["â–ª ",s.name," â€¢ ",(s.size/1024).toFixed(1)," KB"]})},t))}),e.jsx("button",{type:"button",className:"btn btn-analyze "+(F?"loading":""),onClick:e=>{e.preventDefault(),e.stopPropagation(),console.log("ðŸ”˜ Analyze button clicked, files:",u.length),(async()=>{if(F)console.warn("âŒ Analysis already in progress");else{if(0===u.length)return console.warn("âŒ No files to analyze"),void H("Please upload a file before analyzing");try{console.log("ðŸ”® Starting analysis..."),Y(!0),B();const a=`analysis_${Date.now()}`;_(a),console.log("ðŸ“ Analysis ID:",a);const i=52428800,n=u[0];if(n.size>i)throw new Error(`File exceeds 50MB limit (${(n.size/1024/1024).toFixed(1)}MB). Please upload a smaller file.`);let r;console.log("ðŸ“‚ Reading file:",n.name);try{r=await n.text()}catch(e){throw new Error(`Failed to read file: ${e.message}`)}if(!r||0===r.trim().length)throw new Error("The file appears to be empty. Please upload a file with conversation data.");console.log("âœ… File read successfully, content length:",r.length);const o=Math.floor(r.length/200);O(o),console.log("ðŸ”„ Running ML analysis pipeline via API...");const l=I();let c;console.log("ðŸ‘¤ Personalization:",l);const d=5242880,m=1e4;if(n.size>d||o>m){console.log(`ðŸ“¤ File is large (${(n.size/1024/1024).toFixed(1)}MB, ~${o.toLocaleString()} messages)`),console.log("ðŸš€ Using async job queue to avoid timeout...");try{const e=await g.uploadAsync(n,l);console.log(`âœ… Job created: ${e.jobId}`),console.log("â³ Polling for job completion..."),c=await g.pollJobStatus(e.jobId,e=>{console.log(`ðŸ“Š Progress: ${e.progress}% - ${e.message}`),e.progress&&O(e.progress)},2e3),c&&(c={success:!0,...c})}catch(s){throw new Error(`Async analysis failed: ${s.message}`)}}else{console.log(`ðŸ“ File is small (${(n.size/1024/1024).toFixed(1)}MB), using synchronous analysis...`);try{c=await g.uploadAndAnalyze(r,"paste",l)}catch(t){throw new Error(`Analysis pipeline failed: ${t.message}`)}}if(console.log("ðŸ“Š Analysis complete:",c),!c)throw new Error("Analysis returned no results. Please try again.");if(c.success)console.log("âœ… Analysis successful, setting report"),G(c);else{const e=c.error||"Analysis failed - unknown error";console.error("âŒ Analysis failed:",e),console.error("ðŸ“Š Report details:",c),H(e)}}catch(a){console.error("âŒ Error during analysis:",a),console.error("ðŸ“‹ Error stack:",a.stack),H(a.message||"An unexpected error occurred during analysis")}finally{Y(!1)}}})()},disabled:F||0===u.length,style:{marginTop:"20px",padding:"12px 32px",fontSize:"14px",touchAction:"manipulation"},children:F?"ANALYZING...":"ANALYZE NOW"})]}),e.jsxs("div",{className:"eye-footer",children:[e.jsx("p",{className:"footer-text",children:e.jsx(d,{speed:5,children:"BE CAREFUL WHAT YOU WISH FOR â€¢ YOU MIGHT NOT LIKE HOW THE MIRROR LOOKS BACK AT YOU"})}),e.jsx("p",{className:"footer-subtext",children:e.jsx(d,{speed:5,children:"RELATIONSHIP ANALYZER â€¢ UPLOAD YEARS OF TEXT CONVERSATIONS TO REVEAL THE TRUTH"})})]}),e.jsx("button",{className:"btn-back-eye",onClick:J,children:"â† Back to Chat"})]})]}),e.jsx(T,{isOpen:F,totalMessages:E})]})}export{E as default};
